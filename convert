#!/usr/bin/python

##
# Author: Caleb Adams
# Github: github.com/piepieninja
# Converts the VisualSFM .nvm file type into the
# OpenSFM .json type
#

import sys

inputFile = ""
outputFile = ""

expectValue = False
expectCameras = False
expectPoints = False
nvmVersion = ""
cameras = 0
points = 0

cameraFileList = []


if (len(sys.argv) > 1):
    inputFile = sys.argv[1]
else:
    print "USAGE: \n> ./convert input.nvm\n> ./convert input.nvm output.json"
    sys.exit(0)

# read in the file!
with open(inputFile) as f:
    for line in f:
        #print line
        if (nvmVersion == ""): # assumes the file starts with the nvm version
            nvmVersion = line.rstrip('\n')
        elif (line == '\n'):
            expectValue = True
            expectCameras = False
        elif (cameras == 0 and expectValue):
            expectValue = False
            expectCameras = True
            cameras = int(line)
        elif (expectCameras): 
            cameraFileList.append(line[0:line.find(' ')]) # get each camera file location and store it
        elif (points == 0 and expectValue):
            expectValue = False
            expectPoints = True
            points = int(line)

print "Version: " + nvmVersion + "\nCameras: " + str(cameras) + "\nCamera File List: " + str(cameraFileList) + "\nPoints: " + str(points)
